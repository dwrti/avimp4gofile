name: Convert Video to Catbox

on:
  workflow_dispatch: # تشغيل يدوي من تبويب Actions

jobs:
  convert_process:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install FFmpeg
        run: sudo apt-get update && sudo apt-get install -y ffmpeg

      - name: Download Video
        run: |
          # تحميل الفيديو مباشرة من الرابط الذي زودتني به
          curl -L "https://abra--5e4bd525.api.cosmic-crab.buzz/2394d7ac22d65619d4922bec0c6829d4895a3df1/%D9%85%D9%88%D9%83%D8%A7%20%D9%85%D9%88%D9%83%D8%A7%201-51%20VHS/01.avi?api-key=8acbcf1e-732c-4574-a3bf-27e6a85b86f1&download=true&token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NzA0MDM4MDAsInJhdGUiOiI1TSIsInJvbGUiOiJmcmVlIiwic2Vzc2lvbklEIjoiTVRjM01ETXhNell6TUh4T2QzZEJUa1ZvVVZGNlZrVlRiR3hFVjFWc1ZFNVdXazFUTVZaVVVsUldUbFpzVGxKUk1WcFJUbXBTUWxKR1VrZFNhMGt6VjJ0dmVsSXhXazFTTURWS1UwWmtTRTR3TVZaVWJFVTlmR0FPQzB5MDNkcE9jcmtrQmxHN0Y1YU9SbGxZX3JBSUpMZGhMNE5vU0drLSIsImRvbWFpbiI6IndlYnRvci5pbyIsImFnZW50IjoiTW96aWxsYS81LjAgKE1hY2ludG9zaDsgSW50ZWwgTWFjIE9TIFggMTBfMTVfNykgQXBwbGVXZWJLaXQvNjA1LjEuMTUgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzI2LjIgU2FmYXJpLzYwNS4xLjE1IiwicmVtb3RlQWRkcmVzcyI6IjIwMDE6MTZhNDoyNmQ6NGI2NDphYzIxOjg1MDM6YTA5Zjo3NGIzIn0.uixfjhURDlaLUma9yR-m14xb9YiugwWm3cMU-1CMsEg" -o input_video.avi

      - name: Convert to MP4 (Safari Optimized)
        run: |
          # التحويل مع الحفاظ على الجودة الأصلية (CRF 17 تقريباً تطابق الأصل)
          # الإعداد pix_fmt ضروري ليعمل الفيديو على مشغل آبل (Safari)
          ffmpeg -i input_video.avi -c:v libx264 -crf 17 -preset slow -pix_fmt yuv420p -c:a aac -b:a 192k -movflags +faststart safari_ready.mp4

      - name: Upload to Catbox
        run: |
          # رفع الملف الناتج إلى Catbox
          echo "جاري الرفع..."
          RESPONSE=$(curl -F "reqtype=fileupload" -F "fileToUpload=@safari_ready.mp4" https://catbox.moe/user/api.php)
          echo "------------------------------------------------"
          echo "رابط الفيديو النهائي على Catbox هو:"
          echo $RESPONSE
          echo "------------------------------------------------"
