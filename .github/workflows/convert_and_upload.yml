name: Video Converter & Uploader

on:
  workflow_dispatch: # تشغيل يدوي

jobs:
  convert_video:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install FFmpeg
        run: sudo apt-get update && sudo apt-get install -y ffmpeg

      - name: Download Video
        run: |
          curl -L "https://abra--5e4bd525.api.cosmic-crab.buzz/2394d7ac22d65619d4922bec0c6829d4895a3df1/%D9%85%D9%88%D9%83%D8%A7%20%D9%85%D9%88%D9%83%D8%A7%201-51%20VHS/01.avi?api-key=8acbcf1e-732c-4574-a3bf-27e6a85b86f1&download=true&token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NzA0MDAwNTUsInJhdGUiOiI1TSIsInJvbGUiOiJmcmVlIiwic2Vzc2lvbklEIjoiTVRjM01ETXhNell6TUh4T2QzZEJUa1ZvVVZGNlZrVlRiR3hFVjFWc1ZFNVdXazFUTVZaVVVsUldUbFpzVGxKUk1WcFJUbXBTUWxKR1VrZFNhMGt6VjJ0dmVsSXhXazFTTURWS1UwWmtTRTR3TVZaVWJFVTlmR0FPQzB5MDNkcE9jcmtrQmxHN0Y1YU9SbGxZX3JBSUpMZGhMNE5vU0drLSIsImRvbWFpbiI6IndlYnRvci5pbyIsImFnZW50IjoiTW96aWxsYS81LjAgKE1hY2ludG9zaDsgSW50ZWwgTWFjIE9TIFggMTBfMTVfNykgQXBwbGVXZWJLaXQvNjA1LjEuMTUgKEtIVE1MLCBsaWtlIEdlY2tvKSBWZXJzaW9uLzI2LjIgU2FmYXJpLzYwNS4xLjE1IiwicmVtb3RlQWRkcmVzcyI6IjIwMDE6MTZhNDoyNmQ6NGI2NDphYzIxOjg1MDM6YTA5Zjo3NGIzIn0.8fBR0nBcrfsqoCc8F-Rjko5VANgi_SMzY1vpFMYzAbM" -o input_video.avi

      - name: Convert to Safari-Compatible MP4
        run: |
          # نستخدم H.264 و AAC لضمان التشغيل على Safari
          ffmpeg -i input_video.avi -c:v libx264 -pix_fmt yuv420p -c:a aac -b:a 128k output_video.mp4

      - name: Upload to Gofile
        run: |
          # الحصول على أفضل سيرفر متاح حالياً
          SERVER=$(curl -s https://api.gofile.io/getServer | jq -r '.data.server')
          echo "Uploading to server: $SERVER"
          
          # رفع الملف
          RESPONSE=$(curl -F "file=@output_video.mp4" "https://${SERVER}.gofile.io/uploadFile")
          echo "Upload Response: $RESPONSE"
          
          # استخراج رابط التحميل
          DOWNLOAD_PAGE=$(echo $RESPONSE | jq -r '.data.downloadPage')
          echo "### ✅ تم التحويل والرفع بنجاح!" >> $GITHUB_STEP_SUMMARY
          echo "رابط الملف على Gofile: $DOWNLOAD_PAGE" >> $GITHUB_STEP_SUMMARY
