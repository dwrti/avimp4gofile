name: Video Converter & Gofile Uploader

on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù‡Ù†Ø§'
        required: true
        default: ''

jobs:
  convert_and_upload:
    runs-on: ubuntu-latest
    # Ù†Ø­Ø¯Ø¯ Ù…Ù‡Ù„Ø© Ø²Ù…Ù†ÙŠØ© Ø³Ø§Ø¹Ø© ÙƒØ§Ù…Ù„Ø© Ø¹Ø´Ø§Ù† Ù…Ø§ ÙŠÙØµÙ„ Ø¹Ù„ÙŠÙƒ Ù„Ùˆ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙƒØ¨ÙŠØ±
    timeout-minutes: 60 

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Tools (FFmpeg & JQ)
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg jq curl

      - name: Download Video (Resilient Mode)
        run: |
          echo "Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŒ Ø®Ù„Ùƒ Ù…Ø±ØªØ§Ø­..."
          # Ø§Ø³ØªØ®Ø¯Ù…Ù†Ø§ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªÙƒØ±Ø±Ø©ØŒ Ø¥Ø¬Ø¨Ø§Ø± HTTP/1.1ØŒ ÙˆØ§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ùˆ Ø§Ù†Ù‚Ø·Ø¹
          curl -L --http1.1 --retry 10 --retry-max-time 1200 --connect-timeout 60 \
          "${{ github.event.inputs.video_url }}" \
          -o input_video_raw

      - name: Convert to Safari-Ready MP4
        run: |
          echo "Ø¨Ø¯Ø£Ù†Ø§ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„ØµÙŠØºØ© Safari (H.264)..."
          ffmpeg -i input_video_raw -c:v libx264 -profile:v main -level:v 4.0 -pix_fmt yuv420p -c:a aac -b:a 128k -movflags +faststart output_video.mp4

      - name: Upload to Gofile
        id: upload
        run: |
          echo "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ Gofile..."
          # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£ÙØ¶Ù„ Ø³ÙŠØ±ÙØ± Ù…ØªØ§Ø­
          SERVER=$(curl -s https://api.gofile.io/getServer | jq -r '.data.server')
          
          # Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„
          RESPONSE=$(curl -F "file=@output_video.mp4" "https://${SERVER}.gofile.io/uploadFile")
          DOWNLOAD_PAGE=$(echo $RESPONSE | jq -r '.data.downloadPage')
          
          echo "FINAL_URL=$DOWNLOAD_PAGE" >> $GITHUB_ENV
          echo "ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­: $DOWNLOAD_PAGE"

      - name: Final Summary
        run: |
          echo "### ðŸš€ Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!" >> $GITHUB_STEP_SUMMARY
          echo "- **Ø±Ø§Ø¨Ø· Gofile:** ${{ env.FINAL_URL }}" >> $GITHUB_STEP_SUMMARY
          echo "ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„ØµÙŠØºØ© MP4 Ø§Ù„Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Safari." >> $GITHUB_STEP_SUMMARY
